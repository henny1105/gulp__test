!function(t){function e(t,e){this.init(t,e),this.bindingEvent()}t.defaults={key:void 0,gallery:".gallery_list",search:".search",count:50,enableIsotpe:!0},t.fn.myFlickr=function(i){return null==(i=t.extend({},t.defaults,i)).key&&console.error("key는 필수 입력 사항입니다."),new e(this,i),this},e.prototype.init=function(t,e){this.url="https://www.flickr.com/services/rest/?method=flickr.interestingness.getList",this.url_search="https://www.flickr.com/services/rest/?method=flickr.photos.search",this.url_user="https://www.flickr.com/services/rest/?method=flickr.people.getPhotos",this.key=e.key,this.count=e.count,this.frame=t,this.gallery=t.find(e.gallery),this.search=t.find(e.search),this.enableIso=e.enableIsotope},e.prototype.bindingEvent=function(){t("body").prepend(t("<img class='on loading'>").attr("src","img/loading-3.gif")),this.getList({type:"user"}),this.frame.find("h2").on("click",function(){this.gallery.removeClass("on"),t(".loading").addClass("on"),this.getList({type:"user"})}.bind(this)),t(this.search.selector).children("button").on("click",function(t){t.preventDefault(),this.searchTag()}.bind(this)),t(window).on("keypress",function(t){13==t.keyCode&&this.searchTag()}.bind(this));var e=this.gallery.find("li a").selector;t("body").on("click",e,function(e){e.preventDefault();var i=t(e.currentTarget).attr("href");this.createPop(i)}.bind(this)),t("body").on("click",".pop span",(function(){t(".pop").fadeOut(500,(function(){t(".pop").remove()}))}));var i=this.gallery.find("li .profile").selector;t("body").on("click",i,function(e){var i=t(e.currentTarget).find("span").text();this.gallery.removeClass("on"),t(".loading").addClass("on"),this.getList({type:"user",user:i})}.bind(this))},e.prototype.getList=function(e){var i;"interest"==e.type&&(i={url:this.url,dataType:"json",data:{api_key:this.key,per_page:this.count,format:"json",nojsoncallback:1,tagmode:"any",privacy_filter:5}}),"search"==e.type&&(i={url:this.url_search,dataType:"json",data:{api_key:this.key,per_page:this.count,format:"json",nojsoncallback:1,tagmode:"any",privacy_filter:5,tags:e.tag}}),"user"==e.type&&(i={url:this.url_user,dataType:"json",data:{api_key:this.key,per_page:this.count,format:"json",nojsoncallback:1,tagmode:"any",privacy_filter:5,user_id:"191860836@N02"}}),t.ajax(i).success(function(t){var e=t.photos.photo;this.createList(e)}.bind(this)).error((function(t){console.error(t)}))},e.prototype.createList=function(e){var i=t(this.gallery.selector);i.empty(),i.append("<ul>"),i.children("ul").append("<li class='item-sizer'>"),t(e).each(function(e,s){var n=s.title;s.title||(n="No description in this photo."),i.children("ul").append(t("<li class='item'>").append(t("<div class='inner'>").append(t("<a>").attr({href:"https://live.staticflickr.com/"+s.server+"/"+s.id+"_"+s.secret+"_b.jpg"}).append(t("<img>").attr({src:"https://live.staticflickr.com/"+s.server+"/"+s.id+"_"+s.secret+"_w.jpg",onerror:"javascript:this.parentNode.parentNode.parentNode.style='display:none;'"}))).append(t("<p>").text(n)).append(t("<div class='profile'>").append(t("<img>").attr({src:"https://www.flickr.com/buddyicons/"+s.owner+".jpg"}),t("<span>").text(s.owner)))))}.bind(this)),this.enableIso?this.isoLayout():(this.gallery.addClass("on"),t(".loading").removeClass("on"))},e.prototype.isoLayout=function(){var e=t(this.gallery.selector),i=e.find("ul").selector,s=e.find("img"),n=0;t(s).each(function(o,r){r.onload=function(){++n===s.length&&(new Isotope(i,{itemSelector:".item",percentPosition:!0,transitionDuration:"0.8s",masonry:{columnWidth:".item-sizer"}}),e.addClass("on"),t(".loading").removeClass("on"))}}.bind(this))},e.prototype.searchTag=function(){var e=t(this.search.selector).children("input").val();""!=e?(this.gallery.removeClass("on"),t(".loading").addClass("on"),this.getList({type:"search",tag:e}),t(this.search.selector).children("input").val("")):alert("검색어를 입력해주세요.")},e.prototype.createPop=function(e){t("body").append(t("<aside class='pop'>").css({width:"100%",height:"100%",position:"fixed",top:0,left:0,zIndex:10,boxSizing:"border-box",padding:"3vw",background:"rgba(0,0,0,0.8)",display:"none"}).append(t("<img>").attr("src",e).css({width:"100%",height:"100%",objectFit:"contain"}),t("<div class='gallery_content'>"),t("<span>").text("close").css({cursor:"pointer",color:"#fff",position:"absolute",top:20,right:20})).fadeIn())}}(jQuery);